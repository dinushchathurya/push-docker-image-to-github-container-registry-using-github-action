# name: Docker Image CI

# on:
#   push:
#     branches: [ master ]
#     tags:
#       - 'v*.*.*'

#   pull_request:
#     branches: [ master ]

# env: 
#   ProjectName: nodejs-github

# jobs:

#   build:

#     runs-on: ubuntu-latest

#     steps:

#     - name: Set Environment Variable
#       run: echo "RELEASE_VERSION=${GITHUB_REF:11}" >> $GITHUB_ENV

#     - name: Test Environment Variable
#       run: echo ${{ env.RELEASE_VERSION }}
    
#     - name: Checkout of GitHub Repo
#       uses: actions/checkout@v3
          
#     - name: Login to Github Packages
#       uses: docker/login-action@v1
#       with:
#         registry: ghcr.io
#         username: ${{ github.repository_owner }}
#         password: ${{ secrets.GHCR_PAT }}
    
#     - name: Get Tag Name
#       id: tag_name
#       run: |
#         echo ::set-output name=SOURCE_TAG::${GITHUB_REF#refs/tags/}
    
#     - name: Push to GitHub Packages
#       uses: docker/build-push-action@v2
#       with:
#         context: .
#         tags: |
#           ghcr.io/${{ github.repository_owner }}/nodejs-github:${{ steps.tag_name.outputs.SOURCE_TAG }}
#         push: true
    
#     # - name: Get Tag Name
#     #   id: tag_name
#     #   run: |
#     #     echo ::set-output name=SOURCE_TAG::${GITHUB_REF#refs/tags/}

#     # - name: Build image and push to GitHub Container Registry
#     #   run: |
#     #     docker build . --tag ghcr.io/${{ github.repository_owner }}/nodejs-github:$VERSION
#     #     docker push ghcr.io/${{ github.repository_owner }}/nodejs-github:$VERSION
#     #   env:
#     #     VERSION: ${{ steps.tag_name.outputs.SOURCE_TAG }}

#     # - name: Image digest
#     #   run: echo ${{ steps.docker_build.outputs.digest }}

name: Publish Docker image
on:
  push:
    tags:
      - "v*.*.*"
jobs:
  push_to_registry:
    name: Build and push Docker image to Docker Hub
    runs-on: ubuntu-latest
    steps:
      - name: Set environment variable
        run: echo "RELEASE_VERSION=${GITHUB_REF:11}" >> $GITHUB_ENV
      - name: Test environment variable
        run: echo ${{ env.RELEASE_VERSION }}
      - name: Check out GitHub repo
        uses: actions/checkout@v2
      - name: Log in to Docker Hub
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GHCR_PAT }}
      - name: Build image and push to Docker Hub
        uses: docker/build-push-action@v2
        with:
          push: true
          tags: ${{ github.repository }}:${{ env.RELEASE_VERSION }}
          

